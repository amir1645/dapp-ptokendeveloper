<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PToken DApp</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="mobile-container">
    <!-- هدر -->
    <header class="mobile-header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="logo-text">
            <h1>PToken</h1>
            <span class="logo-subtitle">Polygon Network</span>
          </div>
        </div>
        <div class="network-status">
          <div class="status-indicator">
            <div class="pulse-dot"></div>
            <span>آنلاین</span>
          </div>
        </div>
      </div>
    </header>

    <!-- محتوای اصلی -->
    <main class="mobile-main">
      <!-- تب کیف پول -->
      <div id="wallet-tab" class="tab-content active">
        <div class="mobile-section">
          <div class="hero-section">
            <div class="hero-icon">
              <div class="floating-wallet">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="floating-coin coin-1">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-2">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-3">
                <i class="fas fa-circle"></i>
              </div>
            </div>
            <h2 class="hero-title">خوش آمدید</h2>
            <p class="hero-subtitle">برای شروع، کیف پول خود را متصل کنید</p>
          </div>

          <div class="action-card">
            <button id="connect-btn" onclick="connectWallet()" class="btn-connect animated-btn">
              <div class="btn-content">
                <i class="fas fa-plug"></i>
                <span>اتصال به کیف پول</span>
              </div>
              <div class="btn-glow"></div>
            </button>

            <button id="disconnect-btn" onclick="disconnectWallet()" class="btn-disconnect" style="display: none;">
              <i class="fas fa-power-off"></i>
              قطع اتصال
            </button>
          </div>

          <div id="account" class="account-display" style="display: none;">
            <div class="account-card">
              <div class="account-header">
                <i class="fas fa-check-circle"></i>
                <span>اتصال موفق</span>
              </div>
              <div class="account-address"></div>
              <div class="account-balance">
                <span class="balance-label">موجودی:</span>
                <span class="balance-value wallet-balance">0 پالیگان</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب اطلاعات کاربر -->
      <div id="user-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>پروفایل کاربری</h2>
            <div class="user-badge">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <!-- حالت ثبت‌نام نشده -->
          <div id="unregistered-view" class="registration-card">
            <div class="card-header">
              <h3>ثبت‌نام جدید</h3>
              <div class="price-tag">350 پالیگان</div>
            </div>
            
            <div class="form-group">
              <label class="input-label">
                <i class="fas fa-user-friends"></i>
                شناسه کاربر آپلاین
              </label>
              <input id="upline-address" type="number" placeholder="مثال: 1234" class="modern-input">
            </div>

            <div class="position-selector">
              <div class="selector-title">موقعیت قرارگیری</div>
              <div class="position-options">
                <label class="position-card">
                  <input type="radio" name="place" value="left" checked>
                  <div class="card-content">
                    <div class="position-icon left">
                      <i class="fas fa-arrow-left"></i>
                    </div>
                    <span>سمت چپ</span>
                  </div>
                </label>
                <label class="position-card">
                  <input type="radio" name="place" value="right">
                  <div class="card-content">
                    <div class="position-icon right">
                      <i class="fas fa-arrow-right"></i>
                    </div>
                    <span>سمت راست</span>
                  </div>
                </label>
              </div>
            </div>

            <button onclick="register()" class="btn-register animated-btn">
              <i class="fas fa-user-plus"></i>
              تکمیل ثبت‌نام
            </button>
          </div>

          <!-- حالت ثبت‌نام شده -->
          <div id="registered-view" class="user-info-card" style="display: none;">
            <div class="user-id-display">
              <div class="user-id-label">شناسه کاربری شما:</div>
              <div class="user-id-value" id="user-id">-</div>
            </div>
            
            <div class="form-group">
              <label class="input-label">
                <i class="fas fa-user-tag"></i>
                شناسه آپلاین
              </label>
              <div class="modern-input" style="background: rgba(255,255,255,0.1); color: var(--light);">
                <span id="user-upline">-</span>
              </div>
            </div>

            <div class="balance-display">
              <div class="balance-item balance-left">
                <div class="balance-title">
                  <i class="fas fa-arrow-left"></i>
                  <span class="balance-name">ولت های تیم شما در چپ</span>
                </div>
                <div class="balance-count" id="left-balance">0</div>
              </div>
              
              <div class="balance-item balance-right">
                <div class="balance-title">
                  <i class="fas fa-arrow-right"></i>
                  <span class="balance-name">ولت های تیم شما در راست</span>
                </div>
                <div class="balance-count" id="right-balance">0</div>
              </div>
            </div>
          </div>

          <div class="stats-container">
            <div class="stats-grid">
              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-users"></i>
                  </div>
                  <span class="stat-label">ولت های کل تیم شما</span>
                </div>
                <div class="stat-value" id="total-referrals">0</div>
              </div>

              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <span class="stat-label">تعادل خورده</span>
                </div>
                <div class="stat-value" id="balance-count">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب توکن P -->
      <div id="token-p-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>توکن P</h2>
            <div class="user-badge">
              <i class="fas fa-gem"></i>
            </div>
          </div>

          <!-- نمایش قیمت توکن و درصد رشد -->
          <div class="token-price-section">
            <div class="token-price-card">
              <div class="price-icon">
                <i class="fas fa-tag"></i>
              </div>
              <div class="price-info">
                <div class="price-label">قیمت فعلی هر توکن P</div>
                <div class="price-amount" id="p-token-price">0</div>
                <div class="price-currency">پالیگان</div>
              </div>
            </div>

            <!-- کارت درصد رشد -->
            <div class="growth-card" id="growth-card">
              <div class="growth-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="growth-info">
                <div class="growth-label">رشد از روز اول</div>
                <div class="growth-percentage" id="growth-percentage">0%</div>
                <div class="growth-details">
                  <span>اولین روز: </span>
                  <span id="initial-price">0.000010 پالیگان</span>
                </div>
              </div>
            </div>
          </div>

          <!-- نمایش موجودی توکن P و پالیگان -->
          <div class="balance-cards-grid">
            <div class="balance-card token">
              <div class="balance-icon">
                <i class="fas fa-gem"></i>
              </div>
              <div class="balance-info">
                <div class="balance-label">موجودی توکن P</div>
                <div class="balance-amount" id="p-token-balance">0</div>
                <div class="balance-value" id="p-token-value">≈ 0 پالیگان</div>
              </div>
            </div>
            
            <div class="balance-card polygon">
              <div class="balance-icon">
                <i class="fas fa-coins"></i>
              </div>
              <div class="balance-info">
                <div class="balance-label">موجودی پالیگان</div>
                <div class="balance-amount wallet-balance">0</div>
                <div class="balance-value">در کیف پول</div>
              </div>
            </div>
          </div>

          <!-- اقدامات توکن P -->
          <div class="token-actions">
            <!-- بخش خرید توکن P -->
            <div class="token-action-card">
              <div class="action-header">
                <h4>خرید توکن P</h4>
                <div class="action-balance">
                  <i class="fas fa-coins"></i>
                  <span class="wallet-balance">0 پالیگان</span>
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">
                  <i class="fas fa-money-bill-wave"></i>
                  مقدار پالیگان برای خرید
                </label>
                <input type="number" id="buy-amount" class="modern-input" placeholder="0.00" step="0.001" min="0.001">
              </div>
              
              <div class="calculation-result">
                <div class="result-item">
                  <span>دریافت می‌کنید:</span>
                  <strong id="tokens-received">0 توکن P</strong>
                </div>
                <div class="result-item">
                  <span>قیمت هر توکن:</span>
                  <strong id="current-token-price">0 پالیگان</strong>
                </div>
              </div>
              
              <button onclick="buyPTokens()" class="btn-token-action primary">
                <i class="fas fa-shopping-cart"></i>
                خرید توکن P
              </button>
            </div>

            <!-- بخش فروش توکن P -->
            <div class="token-action-card">
              <div class="action-header">
                <h4>فروش توکن P</h4>
                <div class="action-balance">
                  <i class="fas fa-gem"></i>
                  <span id="available-tokens-sell">0 توکن P</span>
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">
                  <i class="fas fa-gem"></i>
                  مقدار توکن P برای فروش
                </label>
                <input type="number" id="sell-amount" class="modern-input" placeholder="0.00" step="0.01" min="0.01">
              </div>
              
              <div class="calculation-result">
                <div class="result-item">
                  <span>دریافت می‌کنید:</span>
                  <strong id="matic-received">0 پالیگان</strong>
                </div>
                <div class="result-item">
                  <span>قیمت هر توکن:</span>
                  <strong id="current-sell-price">0 پالیگان</strong>
                </div>
              </div>
              
              <button onclick="sellPTokens()" class="btn-token-action secondary">
                <i class="fas fa-money-bill-wave"></i>
                فروش توکن P
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- تب ماینر -->
      <div id="miner-tab" class="tab-content">
        <div class="mobile-section">
          <div class="miner-header">
            <h2>سیستم ماینر</h2>
            <div class="miner-global-status" id="miner-global-status">
              <div class="status-indicator"></div>
              <span>در حال بارگذاری...</span>
            </div>
          </div>

          <div class="miner-container">
            <!-- کارت وضعیت ماینر -->
            <div class="miner-status-card">
              <div class="miner-icon">
                <i class="fas fa-hard-hat"></i>
              </div>
              <div class="miner-status-label">وضعیت ماینر</div>
              <div class="miner-status-value" id="miner-status">در حال بارگذاری...</div>
            </div>

            <!-- آمار دقیق ماینر -->
            <div class="miner-stats">
              <div class="miner-stat-card">
                <div class="miner-stat-icon">
                  <i class="fas fa-coins"></i>
                </div>
                <div class="miner-stat-label">پاداش‌های کل ماینر</div>
                <div class="miner-stat-value" id="miner-rewards">0 PToken</div>
              </div>

              <div class="miner-stat-card">
                <div class="miner-stat-icon">
                  <i class="fas fa-wallet"></i>
                </div>
                <div class="miner-stat-label">موجودی پالیگان</div>
                <div class="miner-stat-value wallet-balance">0 پالیگان</div>
              </div>

              <div class="miner-stat-card">
                <div class="miner-stat-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <div class="miner-stat-label">توکن‌های قابل خرید</div>
                <div class="miner-stat-value" id="available-tokens">0 PToken</div>
              </div>

              <div class="miner-stat-card">
                <div class="miner-stat-icon">
                  <i class="fas fa-chart-pie"></i>
                </div>
                <div class="miner-stat-label">تعادل ویژه</div>
                <div class="miner-stat-value" id="special-balance-miner">0</div>
              </div>
            </div>

            <!-- اطلاعات دقیق ماینر -->
            <div class="miner-details">
              <div class="detail-item">
                <span class="detail-label">شناسه کاربری:</span>
                <span class="detail-value" id="miner-user-id">-</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">آپلاین:</span>
                <span class="detail-value" id="miner-upline">-</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">تعداد چپ:</span>
                <span class="detail-value" id="miner-left-count">0</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">تعداد راست:</span>
                <span class="detail-value" id="miner-right-count">0</span>
              </div>
            </div>

            <!-- بخش جدید: خرید توکن ماینر با پول قرارداد -->
            <div class="miner-purchase-section">
              <div class="miner-action-card">
                <div class="action-header">
                  <div class="action-title">خرید توکن ماینر از قرارداد</div>
                  <div class="action-balance">
                    <i class="fas fa-coins"></i>
                    <span id="contract-polygon-balance">0 پالیگان</span>
                  </div>
                </div>
                
                <div class="input-group">
                  <label class="input-label">
                    <i class="fas fa-money-bill-wave"></i>
                    مقدار پالیگان برای خرید توکن ماینر
                  </label>
                  <input type="number" id="miner-purchase-amount" class="modern-input" placeholder="0.00" step="0.001" min="0.001">
                </div>
                
                <div class="calculation-result">
                  <div class="result-item">
                    <span>دریافت می‌کنید:</span>
                    <strong id="miner-tokens-received">0 توکن ماینر</strong>
                  </div>
                </div>
                
                <button onclick="buyMinerWithContract()" class="btn-miner-action primary">
                  <i class="fas fa-shopping-cart"></i>
                  خرید از قرارداد
                </button>
              </div>
            </div>

            <!-- تبدیل پالیگان به توکن P برای ماینر -->
            <div class="miner-conversion-section">
              <div class="miner-action-card">
                <div class="action-header">
                  <div class="action-title">تبدیل پالیگان به توکن P</div>
                  <div class="action-balance">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="conversion-balance">0 پالیگان</span>
                  </div>
                </div>
                
                <div class="input-group">
                  <label class="input-label">
                    <i class="fas fa-coins"></i>
                    مقدار پالیگان برای تبدیل
                  </label>
                  <input type="number" id="conversion-amount" class="modern-input" placeholder="0.00" step="0.001" min="0.001">
                </div>
                
                <div class="calculation-result">
                  <div class="result-item">
                    <span>دریافت می‌کنید:</span>
                    <strong id="p-tokens-received">0 توکن P</strong>
                  </div>
                </div>
                
                <button onclick="convertToPToken()" class="btn-miner-action secondary">
                  <i class="fas fa-sync-alt"></i>
                  تبدیل به توکن P
                </button>
              </div>
            </div>

            <!-- اقدامات ماینر -->
            <div class="miner-actions">
              <!-- خرید توکن ماینر -->
              <div class="miner-action-card">
                <div class="action-header">
                  <div class="action-title">خرید توکن ماینر</div>
                  <div class="action-balance">
                    <i class="fas fa-coins"></i>
                    <span class="wallet-balance">0 پالیگان</span>
                  </div>
                </div>
                <button onclick="buyMinerTokens()" class="btn-miner-action">
                  <i class="fas fa-donate"></i>
                  خرید توکن ماینر
                </button>
              </div>

              <!-- توزیع توکن ماینر -->
              <div class="miner-action-card">
                <div class="action-header">
                  <div class="action-title">توزیع توکن ماینر</div>
                  <div class="action-balance">
                    <i class="fas fa-gem"></i>
                    <span id="available-miner-tokens">0 PToken</span>
                  </div>
                </div>
                <button onclick="distributeMinerTokens()" class="btn-miner-action secondary">
                  <i class="fas fa-share-alt"></i>
                  توزیع توکن ماینر
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب برداشت -->
      <div id="withdraw-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>برداشت</h2>
            <div class="user-badge">
              <i class="fas fa-money-bill-wave"></i>
            </div>
          </div>

          <div class="withdraw-container">
            <!-- تایمر شمارش معکوس -->
            <div class="timer-container">
              <div class="timer-label">زمان باقی‌مانده تا برداشت بعدی</div>
              <div class="timer-display" id="countdown-timer">--:--:--</div>
              <div class="countdown-note">هر 6 ساعت یکبار قابل برداشت است</div>
            </div>

            <!-- کارت‌های برداشت -->
            <div class="withdraw-cards">
              <!-- استخر پاداش -->
              <div class="withdraw-card">
                <div class="withdraw-card-header">
                  <div class="withdraw-card-icon">
                    <i class="fas fa-wallet"></i>
                  </div>
                  <div class="withdraw-card-title">استخر پاداش</div>
                </div>
                
                <div class="pool-stats">
                  <div class="pool-stat">
                    <div class="pool-stat-icon">
                      <i class="fas fa-coins"></i>
                    </div>
                    <div class="pool-stat-label">پالیگان موجود</div>
                    <div class="pool-stat-value" id="pool-balance">0</div>
                  </div>
                  
                  <div class="pool-stat">
                    <div class="pool-stat-icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="pool-stat-label">تعداد تعادل‌ها</div>
                    <div class="pool-stat-value" id="pool-balance-count">0</div>
                  </div>
                </div>

                <div class="withdraw-card-content">
                  <div class="amount-display">
                    <span class="amount" id="pool-amount">0</span>
                    <span class="currency">پالیگان</span>
                  </div>
                  <button onclick="withdrawPool()" class="btn-withdraw" id="pool-withdraw-btn">
                    <i class="fas fa-download"></i>
                    برداشت پاداش
                  </button>
                </div>
              </div>

              <!-- استخر پاداش ویژه -->
              <div class="withdraw-card">
                <div class="withdraw-card-header">
                  <div class="withdraw-card-icon">
                    <i class="fas fa-gem"></i>
                  </div>
                  <div class="withdraw-card-title">استخر پاداش ویژه</div>
                </div>
                
                <div class="pool-stats">
                  <div class="pool-stat">
                    <div class="pool-stat-icon">
                      <i class="fas fa-coins"></i>
                    </div>
                    <div class="pool-stat-label">پالیگان موجود</div>
                    <div class="pool-stat-value" id="special-pool-balance">0</div>
                  </div>
                  
                  <div class="pool-stat">
                    <div class="pool-stat-icon">
                      <i class="fas fa-trophy"></i>
                    </div>
                    <div class="pool-stat-label">تعداد سقف‌ها</div>
                    <div class="pool-stat-value" id="special-pool-count">0</div>
                  </div>
                </div>

                <div class="withdraw-card-content">
                  <div class="amount-display">
                    <span class="amount" id="special-amount">0</span>
                    <span class="currency">پالیگان</span>
                  </div>
                  <button onclick="withdrawSpecials()" class="btn-withdraw" id="special-withdraw-btn">
                    <i class="fas fa-download"></i>
                    برداشت ویژه
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ناوبری پایین -->
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="switchTab('wallet')">
        <div class="nav-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <span class="nav-label">کیف پول</span>
      </div>
      <div class="nav-item" onclick="switchTab('user')">
        <div class="nav-icon">
          <i class="fas fa-user"></i>
        </div>
        <span class="nav-label">پروفایل</span>
      </div>
      <div class="nav-item" onclick="switchTab('token-p')">
        <div class="nav-icon">
          <i class="fas fa-gem"></i>
        </div>
        <span class="nav-label">توکن P</span>
      </div>
      <div class="nav-item" onclick="switchTab('miner')">
        <div class="nav-icon">
          <i class="fas fa-hard-hat"></i>
        </div>
        <span class="nav-label">ماینر</span>
      </div>
      <div class="nav-item" onclick="switchTab('withdraw')">
        <div class="nav-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <span class="nav-label">برداشت</span>
      </div>
    </nav>
  </div>

  <div id="message" class="message-toast"></div>

  <script src="app.js"></script>
</body>
</html>